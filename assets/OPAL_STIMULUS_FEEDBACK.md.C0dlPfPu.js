import{_ as i,c as a,o as n,ag as t}from"./chunks/framework.dvv-DFtf.js";const c=JSON.parse('{"title":"opal_stimulus Feedback / Feature Requests","description":"","frontmatter":{},"headers":[],"relativePath":"OPAL_STIMULUS_FEEDBACK.md","filePath":"OPAL_STIMULUS_FEEDBACK.md"}'),e={name:"OPAL_STIMULUS_FEEDBACK.md"};function l(h,s,p,k,r,d){return n(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="opal-stimulus-feedback-feature-requests" tabindex="-1">opal_stimulus Feedback / Feature Requests <a class="header-anchor" href="#opal-stimulus-feedback-feature-requests" aria-label="Permalink to &quot;opal_stimulus Feedback / Feature Requests&quot;">​</a></h1><p>This document summarizes issues and feature requests discovered while developing with <code>opal_stimulus</code> gem in the opal-vite project.</p><h2 id="context" tabindex="-1">Context <a class="header-anchor" href="#context" aria-label="Permalink to &quot;Context&quot;">​</a></h2><p>We are building Stimulus controllers in Ruby using <code>opal_stimulus</code>. The goal is to write Ruby-like code as much as possible, minimizing the use of JavaScript backticks.</p><h2 id="issues-discovered" tabindex="-1">Issues Discovered <a class="header-anchor" href="#issues-discovered" aria-label="Permalink to &quot;Issues Discovered&quot;">​</a></h2><h3 id="_1-nested-property-access-fails-with-method-missing" tabindex="-1">1. Nested Property Access Fails with method_missing <a class="header-anchor" href="#_1-nested-property-access-fails-with-method-missing" aria-label="Permalink to &quot;1. Nested Property Access Fails with method_missing&quot;">​</a></h3><p><strong>Problem:</strong> When accessing nested properties through <code>JS::Proxy</code>, <code>method_missing</code> fails to convert snake_case to camelCase properly.</p><p><strong>Example:</strong></p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># This fails with: undefined method \`rules\` for #&lt;JS::Proxy:0xe6&gt;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">rules</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = field.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dataset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rules</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Workaround: Use [] accessor</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">rules</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = field.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dataset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:rules</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Still doesn&#39;t work with JS::Proxy</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Current solution: wrap with custom JsObject</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">rules</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wrap_js</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(field.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dataset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:rules</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Works</span></span></code></pre></div><p><strong>Expected:</strong> <code>field.dataset.rules</code> should work and automatically convert to <code>field.dataset.rules</code> in JavaScript.</p><h3 id="_2-stimulus-target-methods-not-converted-has-xxx-target-xxx-target" tabindex="-1">2. Stimulus Target Methods Not Converted (has_xxx_target, xxx_target) <a class="header-anchor" href="#_2-stimulus-target-methods-not-converted-has-xxx-target-xxx-target" aria-label="Permalink to &quot;2. Stimulus Target Methods Not Converted (has_xxx_target, xxx_target)&quot;">​</a></h3><p><strong>Problem:</strong> Stimulus provides <code>hasXxxTarget</code> and <code>xxxTarget</code> methods, but calling <code>has_xxx_target</code> from Ruby returns <code>undefined</code> instead of being converted to <code>hasXxxTarget</code>.</p><p><strong>Example:</strong></p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># This returns undefined</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">has_total_fields_target  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Expected: this.hasTotalFieldsTarget</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Workaround: Use backticks</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`this.hasTotalFieldsTarget\`</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Works</span></span></code></pre></div><p><strong>Expected:</strong> <code>has_total_fields_target</code> should be converted to <code>this.hasTotalFieldsTarget</code>.</p><h3 id="_3-event-callback-not-properly-wrapped" tabindex="-1">3. Event Callback Not Properly Wrapped <a class="header-anchor" href="#_3-event-callback-not-properly-wrapped" aria-label="Permalink to &quot;3. Event Callback Not Properly Wrapped&quot;">​</a></h3><p><strong>Problem:</strong> When using <code>add_event_listener</code> with a block, the event object passed to the callback is not properly wrapped as <code>JS::Proxy</code>.</p><p><strong>Example:</strong></p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Event object is raw JavaScript, not wrapped</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add_event_listener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;click&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |event|</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # event.current_target fails - event is not wrapped</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Workaround: Use backticks for event listeners</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`window.addEventListener(&#39;show-toast&#39;, (e) =&gt; {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  this.$show(e.detail.message);</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">});\`</span></span></code></pre></div><p><strong>Expected:</strong> The event object should be automatically wrapped so Ruby methods work.</p><h3 id="_4-controller-instance-not-accessible-via-to-n" tabindex="-1">4. Controller Instance Not Accessible via to_n <a class="header-anchor" href="#_4-controller-instance-not-accessible-via-to-n" aria-label="Permalink to &quot;4. Controller Instance Not Accessible via to_n&quot;">​</a></h3><p><strong>Problem:</strong> Inside a StimulusController, <code>self.to_n</code> raises <code>undefined method &#39;to_n&#39;</code>, making it difficult to access the native controller instance.</p><p><strong>Example:</strong></p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> MyController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> StimulusController</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> some_method</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    ctrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">to_n</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Fails: undefined method \`to_n\`</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Workaround: Use \`this\` inside backticks</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    \`this.someTarget\`</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Works</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><p><strong>Expected:</strong> <code>self.to_n</code> should return the native JavaScript controller instance.</p><h3 id="_5-array-length-index-access-requires-backticks" tabindex="-1">5. Array Length/Index Access Requires Backticks <a class="header-anchor" href="#_5-array-length-index-access-requires-backticks" aria-label="Permalink to &quot;5. Array Length/Index Access Requires Backticks&quot;">​</a></h3><p><strong>Problem:</strong> When working with arrays (like <code>field_targets</code>), <code>.length</code> and index access <code>[i]</code> don&#39;t work properly through JS::Proxy.</p><p><strong>Example:</strong></p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">targets</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = field_targets  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Returns Array</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = targets.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">length</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # Returns Ruby Array length (may not match)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Workaround: Use backticks</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#{targets.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">to_n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.length\`</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#{targets.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">to_n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#{i}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]\`</span></span></code></pre></div><p><strong>Expected:</strong> <code>targets.length</code> and <code>targets[i]</code> should work properly for JavaScript arrays.</p><h3 id="_6-nil-check-on-js-proxy-objects-fails" tabindex="-1">6. nil? Check on JS::Proxy Objects Fails <a class="header-anchor" href="#_6-nil-check-on-js-proxy-objects-fails" aria-label="Permalink to &quot;6. nil? Check on JS::Proxy Objects Fails&quot;">​</a></h3><p><strong>Problem:</strong> Calling <code>.nil?</code> on a JS::Proxy object that wraps null/undefined raises an error trying to access <code>$$pristine</code> property.</p><p><strong>Example:</strong></p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">form_group</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = field.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">closest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;.form-group&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> form_group.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nil?</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Fails: Cannot read properties of undefined (reading &#39;$$pristine&#39;)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Workaround: Use backticks for null check</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> unless</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#{form_group.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">to_n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> != null\`</span></span></code></pre></div><p><strong>Expected:</strong> <code>.nil?</code> should work on JS::Proxy objects that wrap null/undefined.</p><h2 id="workaround-jsproxyex-module" tabindex="-1">Workaround: JsProxyEx Module <a class="header-anchor" href="#workaround-jsproxyex-module" aria-label="Permalink to &quot;Workaround: JsProxyEx Module&quot;">​</a></h2><p>We created a <code>JsProxyEx</code> module to work around these issues:</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">module</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> JsProxyEx</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Wrap JS::Proxy objects for enhanced access</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> wrap_js</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(obj)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> obj.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nil?</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    native</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = obj.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">respond_to?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:to_n</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> obj.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">to_n</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : obj</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    JsObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(native)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Stimulus target helpers</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> has_target?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target_name)</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    camel_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">snake_to_camel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target_name.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">to_s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    has_method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;has</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#{camel_name[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">].</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">upcase</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}#{camel_name[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">..</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Target&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    \`this[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#{has_method}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]\`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> set_target_text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target_name, text)</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    camel_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">snake_to_camel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target_name.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">to_s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    has_method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;has</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#{camel_name[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">].</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">upcase</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}#{camel_name[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">..</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Target&quot;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    target_method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#{camel_name}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Target&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    \`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      if (this[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#{has_method}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]) {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        this[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#{target_method}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">].textContent = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#{text}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      }</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    \`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # JsObject class with snake_case -&gt; camelCase conversion</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> JsObject</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> method_missing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(name, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">args, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">block)</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">      camel_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">snake_to_camel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(name.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">to_s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # ... method call or property access</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> []</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key)</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">      camel_key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">snake_to_camel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">to_s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">      result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@native</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#{camel_key}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]\`</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      wrap_result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h2 id="feature-requests" tabindex="-1">Feature Requests <a class="header-anchor" href="#feature-requests" aria-label="Permalink to &quot;Feature Requests&quot;">​</a></h2><h3 id="_1-enhanced-method-missing-for-js-proxy" tabindex="-1">1. Enhanced method_missing for JS::Proxy <a class="header-anchor" href="#_1-enhanced-method-missing-for-js-proxy" aria-label="Permalink to &quot;1. Enhanced method_missing for JS::Proxy&quot;">​</a></h3><p>Add automatic snake_case to camelCase conversion in <code>method_missing</code>:</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Desired behavior</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">field.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dataset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rules</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # -&gt; field.dataset.rules</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">event.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">current_target</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       # -&gt; event.currentTarget (already works!)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">element.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query_selector_all</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # -&gt; element.querySelectorAll (already works!)</span></span></code></pre></div><h3 id="_2-stimulus-specific-helpers" tabindex="-1">2. Stimulus-Specific Helpers <a class="header-anchor" href="#_2-stimulus-specific-helpers" aria-label="Permalink to &quot;2. Stimulus-Specific Helpers&quot;">​</a></h3><p>Add built-in support for Stimulus target patterns:</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Desired API</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">has_target?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:submit_btn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -&gt; this.hasSubmitBtnTarget</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:submit_btn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -&gt; this.submitBtnTarget</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">targets</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:field</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)               </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -&gt; this.fieldTargets</span></span></code></pre></div><h3 id="_3-controller-instance-access" tabindex="-1">3. Controller Instance Access <a class="header-anchor" href="#_3-controller-instance-access" aria-label="Permalink to &quot;3. Controller Instance Access&quot;">​</a></h3><p>Make <code>self.to_n</code> work inside StimulusController:</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> MyController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> StimulusController</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> method</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    native_ctrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">to_n</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Should return JS controller instance</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h3 id="_4-proper-event-wrapping-in-callbacks" tabindex="-1">4. Proper Event Wrapping in Callbacks <a class="header-anchor" href="#_4-proper-event-wrapping-in-callbacks" aria-label="Permalink to &quot;4. Proper Event Wrapping in Callbacks&quot;">​</a></h3><p>Automatically wrap event objects in callbacks:</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add_event_listener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;click&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |event|</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  event.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">current_target</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Should work (event wrapped as JS::Proxy)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  event.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">prevent_default</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # Should work</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h2 id="summary-table" tabindex="-1">Summary Table <a class="header-anchor" href="#summary-table" aria-label="Permalink to &quot;Summary Table&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Issue</th><th>Current Workaround</th><th>Desired Solution</th></tr></thead><tbody><tr><td><code>dataset.rules</code> fails</td><td><code>wrap_js(dataset)[:rules]</code></td><td>Native support</td></tr><tr><td><code>has_xxx_target</code> undefined</td><td>Backticks with <code>this.hasXxxTarget</code></td><td>Auto-conversion</td></tr><tr><td>Event not wrapped in callback</td><td>Backticks for event listeners</td><td>Auto-wrap</td></tr><tr><td><code>self.to_n</code> fails</td><td>Use <code>this</code> in backticks</td><td>Make <code>to_n</code> work</td></tr><tr><td>Array <code>.length</code> incorrect</td><td><code>targets.to_n.length</code> in backticks</td><td>Native support</td></tr><tr><td><code>.nil?</code> on null JS object fails</td><td><code>form_group.to_n != null</code> in backticks</td><td>Handle null properly</td></tr></tbody></table><h2 id="files-created" tabindex="-1">Files Created <a class="header-anchor" href="#files-created" aria-label="Permalink to &quot;Files Created&quot;">​</a></h2><ul><li><code>examples/form-validation-app/app/opal/concerns/js_proxy_ex.rb</code> - Extended proxy module</li><li><code>docs/OPAL_STIMULUS_FEEDBACK.md</code> - This document</li></ul><hr><p><strong>Created:</strong> 2025-12-16 <strong>opal_stimulus version:</strong> (current) <strong>opal version:</strong> 3.2.0</p>`,57)])])}const g=i(e,[["render",l]]);export{c as __pageData,g as default};
