import{_ as i,c as a,o as n,ag as t}from"./chunks/framework.CgSRFIgr.js";const c=JSON.parse('{"title":"CDN Support","description":"","frontmatter":{},"headers":[],"relativePath":"guide/cdn.md","filePath":"guide/cdn.md"}'),e={name:"guide/cdn.md"};function l(h,s,p,o,r,d){return n(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="cdn-support" tabindex="-1">CDN Support <a class="header-anchor" href="#cdn-support" aria-label="Permalink to &quot;CDN Support&quot;">​</a></h1><p>opal-vite v0.3.5+ supports loading the Opal runtime from CDN, which can significantly reduce bundle size and improve caching.</p><h2 id="benefits" tabindex="-1">Benefits <a class="header-anchor" href="#benefits" aria-label="Permalink to &quot;Benefits&quot;">​</a></h2><ul><li><strong>Reduced bundle size</strong>: Opal runtime (~200KB minified) is loaded from CDN instead of being bundled</li><li><strong>Better caching</strong>: CDN files are cached across multiple sites</li><li><strong>Faster initial loads</strong>: Users who visited other Opal-powered sites may already have the runtime cached</li></ul><h2 id="configuration" tabindex="-1">Configuration <a class="header-anchor" href="#configuration" aria-label="Permalink to &quot;Configuration&quot;">​</a></h2><h3 id="using-a-cdn-provider" tabindex="-1">Using a CDN Provider <a class="header-anchor" href="#using-a-cdn-provider" aria-label="Permalink to &quot;Using a CDN Provider&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// vite.config.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vite&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> opal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vite-plugin-opal&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  plugins: [</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    opal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      cdn: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;opalrb&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Recommended: Official Opal CDN</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      opalVersion: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1.8.2&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><h3 id="supported-cdn-providers" tabindex="-1">Supported CDN Providers <a class="header-anchor" href="#supported-cdn-providers" aria-label="Permalink to &quot;Supported CDN Providers&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Provider</th><th>Option Value</th><th>URL Pattern</th></tr></thead><tbody><tr><td>Opal CDN (Recommended)</td><td><code>&#39;opalrb&#39;</code></td><td><code>https://cdn.opalrb.com/opal/{version}/opal.min.js</code></td></tr><tr><td>jsDelivr</td><td><code>&#39;jsdelivr&#39;</code></td><td><code>https://cdn.jsdelivr.net/gh/opal/opal-cdn@{version}/opal/{version}/opal.min.js</code></td></tr><tr><td>unpkg</td><td><code>&#39;unpkg&#39;</code></td><td>Falls back to Opal CDN</td></tr></tbody></table><h3 id="using-a-custom-cdn-url" tabindex="-1">Using a Custom CDN URL <a class="header-anchor" href="#using-a-custom-cdn-url" aria-label="Permalink to &quot;Using a Custom CDN URL&quot;">​</a></h3><p>You can also specify a custom CDN URL:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">opal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cdn: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;https://my-cdn.example.com/opal/1.8.2/opal.min.js&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><h2 id="options" tabindex="-1">Options <a class="header-anchor" href="#options" aria-label="Permalink to &quot;Options&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Option</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>cdn</code></td><td><code>&#39;opalrb&#39; | &#39;jsdelivr&#39; | &#39;unpkg&#39; | string | false</code></td><td><code>false</code></td><td>CDN provider or custom URL</td></tr><tr><td><code>opalVersion</code></td><td><code>string</code></td><td><code>&#39;1.8.2&#39;</code></td><td>Opal version to load from CDN</td></tr></tbody></table><h2 id="how-it-works" tabindex="-1">How It Works <a class="header-anchor" href="#how-it-works" aria-label="Permalink to &quot;How It Works&quot;">​</a></h2><p>When CDN mode is enabled:</p><ol><li><strong>HTML Injection</strong>: A <code>&lt;script&gt;</code> tag pointing to the CDN is automatically injected into your HTML</li><li><strong>Runtime Stub</strong>: The virtual <code>/@opal-runtime</code> module returns a stub that verifies Opal is loaded</li><li><strong>Both Modes</strong>: Works in both development and production builds</li></ol><h3 id="generated-html" tabindex="-1">Generated HTML <a class="header-anchor" href="#generated-html" aria-label="Permalink to &quot;Generated HTML&quot;">​</a></h3><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&lt;!-- CDN mode (using opalrb) --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">head</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> src</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://cdn.opalrb.com/opal/1.8.2/opal.min.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">head</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&lt;!-- Local mode (default) --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">head</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;module&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> src</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/@opal-runtime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">head</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h2 id="when-to-use-cdn-mode" tabindex="-1">When to Use CDN Mode <a class="header-anchor" href="#when-to-use-cdn-mode" aria-label="Permalink to &quot;When to Use CDN Mode&quot;">​</a></h2><h3 id="recommended-for" tabindex="-1">Recommended for: <a class="header-anchor" href="#recommended-for" aria-label="Permalink to &quot;Recommended for:&quot;">​</a></h3><ul><li>Production deployments</li><li>Sites with multiple Opal-powered pages</li><li>When bundle size is a concern</li></ul><h3 id="not-recommended-for" tabindex="-1">Not recommended for: <a class="header-anchor" href="#not-recommended-for" aria-label="Permalink to &quot;Not recommended for:&quot;">​</a></h3><ul><li>Development (local runtime provides better debugging)</li><li>Offline applications</li><li>Environments with restricted network access</li></ul><h2 id="example-production-configuration" tabindex="-1">Example: Production Configuration <a class="header-anchor" href="#example-production-configuration" aria-label="Permalink to &quot;Example: Production Configuration&quot;">​</a></h2><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// vite.config.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vite&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> opal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vite-plugin-opal&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  plugins: [</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    opal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Use CDN in production, local in development</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      cdn: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NODE_ENV</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;production&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;opalrb&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      opalVersion: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1.8.2&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      sourceMap: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NODE_ENV</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;production&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">​</a></h2><h3 id="opal-runtime-not-found-error" tabindex="-1">&quot;Opal runtime not found&quot; Error <a class="header-anchor" href="#opal-runtime-not-found-error" aria-label="Permalink to &quot;&quot;Opal runtime not found&quot; Error&quot;">​</a></h3><p>If you see this error in the console, the CDN script hasn&#39;t loaded properly. Check:</p><ol><li>Network connectivity to the CDN</li><li>CDN URL is correct</li><li>Script tag is in the HTML <code>&lt;head&gt;</code> before your application code</li></ol><h3 id="version-mismatch" tabindex="-1">Version Mismatch <a class="header-anchor" href="#version-mismatch" aria-label="Permalink to &quot;Version Mismatch&quot;">​</a></h3><p>Ensure the <code>opalVersion</code> matches the Opal gem version in your project:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check gem version</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bundle</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> show</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> opal</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Update vite.config.ts to match</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">opal(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  cdn:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;opalrb&#39;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  opalVersion:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;1.8.2&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  //</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Match</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> your</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> version</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><h2 id="related" tabindex="-1">Related <a class="header-anchor" href="#related" aria-label="Permalink to &quot;Related&quot;">​</a></h2><ul><li><a href="/opal-vite/guide/installation.html">Installation Guide</a> - Basic setup</li><li><a href="/opal-vite/guide/production-build.html">Production Build</a> - Build optimization</li></ul>`,35)])])}const g=i(e,[["render",l]]);export{c as __pageData,g as default};
