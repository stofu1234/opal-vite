import{_ as a,c as i,o as n,ag as e}from"./chunks/framework.CgSRFIgr.js";const o=JSON.parse('{"title":"ActionCableHelpers","description":"","frontmatter":{},"headers":[],"relativePath":"api/v1/en/action_cable_helpers.md","filePath":"api/v1/en/action_cable_helpers.md"}'),t={name:"api/v1/en/action_cable_helpers.md"};function l(h,s,p,k,d,r){return n(),i("div",null,[...s[0]||(s[0]=[e(`<h1 id="actioncablehelpers" tabindex="-1">ActionCableHelpers <a class="header-anchor" href="#actioncablehelpers" aria-label="Permalink to &quot;ActionCableHelpers&quot;">​</a></h1><p>Ruby-friendly DSL for ActionCable WebSocket communication from Opal/Stimulus controllers.</p><h2 id="prerequisites" tabindex="-1">Prerequisites <a class="header-anchor" href="#prerequisites" aria-label="Permalink to &quot;Prerequisites&quot;">​</a></h2><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// In your main.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { createConsumer } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@rails/actioncable&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window.ActionCable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { createConsumer }</span></span></code></pre></div><h2 id="usage" tabindex="-1">Usage <a class="header-anchor" href="#usage" aria-label="Permalink to &quot;Usage&quot;">​</a></h2><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ChatController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> StimulusController</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  include</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> OpalVite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Concerns</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">V1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ActionCableHelpers</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> connect</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    cable_connect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/cable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    cable_subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ChatChannel&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      params:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">room_id:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      on_received:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data) { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handle_message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data) }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> disconnect</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cable_disconnect</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> send_message</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    cable_perform</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:speak</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">message:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> target_value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:input</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h2 id="consumer-management" tabindex="-1">Consumer Management <a class="header-anchor" href="#consumer-management" aria-label="Permalink to &quot;Consumer Management&quot;">​</a></h2><h3 id="cable-connect-url-cable" tabindex="-1"><code>cable_connect(url = &quot;/cable&quot;)</code> <a class="header-anchor" href="#cable-connect-url-cable" aria-label="Permalink to &quot;\`cable_connect(url = &quot;/cable&quot;)\`&quot;">​</a></h3><p>Create and store an ActionCable consumer.</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cable_connect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/cable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cable_connect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;wss://api.example.com/cable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="cable-consumer" tabindex="-1"><code>cable_consumer</code> <a class="header-anchor" href="#cable-consumer" aria-label="Permalink to &quot;\`cable_consumer\`&quot;">​</a></h3><p>Get the current ActionCable consumer instance.</p><h3 id="cable-disconnect" tabindex="-1"><code>cable_disconnect</code> <a class="header-anchor" href="#cable-disconnect" aria-label="Permalink to &quot;\`cable_disconnect\`&quot;">​</a></h3><p>Disconnect and cleanup the ActionCable consumer.</p><h3 id="cable-connected" tabindex="-1"><code>cable_connected?</code> <a class="header-anchor" href="#cable-connected" aria-label="Permalink to &quot;\`cable_connected?\`&quot;">​</a></h3><p>Check if ActionCable is connected.</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cable_connected?</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  cable_perform</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:ping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h2 id="subscription-management" tabindex="-1">Subscription Management <a class="header-anchor" href="#subscription-management" aria-label="Permalink to &quot;Subscription Management&quot;">​</a></h2><h3 id="subscribe-to-channel-name-params-setup-block" tabindex="-1"><code>subscribe_to(channel_name, params = {}, &amp;setup_block)</code> <a class="header-anchor" href="#subscribe-to-channel-name-params-setup-block" aria-label="Permalink to &quot;\`subscribe_to(channel_name, params = {}, &amp;setup_block)\`&quot;">​</a></h3><p>Subscribe to an ActionCable channel with setup block.</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">subscribe_to</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ChatChannel&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">room_id:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |subscription|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  on_cable_connected</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(subscription) { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">puts</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Connected!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  on_cable_received</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(subscription) { |data| </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handle_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data) }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h3 id="cable-subscribe-channel-name-params-on-connected-on-disconnected-on-received-on-rejected" tabindex="-1"><code>cable_subscribe(channel_name, params:, on_connected:, on_disconnected:, on_received:, on_rejected:)</code> <a class="header-anchor" href="#cable-subscribe-channel-name-params-on-connected-on-disconnected-on-received-on-rejected" aria-label="Permalink to &quot;\`cable_subscribe(channel_name, params:, on_connected:, on_disconnected:, on_received:, on_rejected:)\`&quot;">​</a></h3><p>Subscribe with all callbacks in one call.</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cable_subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;NotificationChannel&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  params:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">user_id:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> current_user_id },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  on_connected:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { show_connected },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  on_received:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data) { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">display_notification</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data) }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="quick-subscribe-channel-name-params-on-received" tabindex="-1"><code>quick_subscribe(channel_name, params = {}, &amp;on_received)</code> <a class="header-anchor" href="#quick-subscribe-channel-name-params-on-received" aria-label="Permalink to &quot;\`quick_subscribe(channel_name, params = {}, &amp;on_received)\`&quot;">​</a></h3><p>Quick subscription for simple channels.</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">quick_subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;AlertChannel&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |data|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  show_alert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h3 id="unsubscribe-from-channel-name-params" tabindex="-1"><code>unsubscribe_from(channel_name, params = {})</code> <a class="header-anchor" href="#unsubscribe-from-channel-name-params" aria-label="Permalink to &quot;\`unsubscribe_from(channel_name, params = {})\`&quot;">​</a></h3><p>Unsubscribe from a channel.</p><h3 id="get-subscription-channel-name-params" tabindex="-1"><code>get_subscription(channel_name, params = {})</code> <a class="header-anchor" href="#get-subscription-channel-name-params" aria-label="Permalink to &quot;\`get_subscription(channel_name, params = {})\`&quot;">​</a></h3><p>Get a subscription by channel name and params.</p><h2 id="subscription-callbacks" tabindex="-1">Subscription Callbacks <a class="header-anchor" href="#subscription-callbacks" aria-label="Permalink to &quot;Subscription Callbacks&quot;">​</a></h2><h3 id="on-cable-connected-subscription-block" tabindex="-1"><code>on_cable_connected(subscription, &amp;block)</code> <a class="header-anchor" href="#on-cable-connected-subscription-block" aria-label="Permalink to &quot;\`on_cable_connected(subscription, &amp;block)\`&quot;">​</a></h3><p>Set the connected callback.</p><h3 id="on-cable-disconnected-subscription-block" tabindex="-1"><code>on_cable_disconnected(subscription, &amp;block)</code> <a class="header-anchor" href="#on-cable-disconnected-subscription-block" aria-label="Permalink to &quot;\`on_cable_disconnected(subscription, &amp;block)\`&quot;">​</a></h3><p>Set the disconnected callback.</p><h3 id="on-cable-received-subscription-block" tabindex="-1"><code>on_cable_received(subscription, &amp;block)</code> <a class="header-anchor" href="#on-cable-received-subscription-block" aria-label="Permalink to &quot;\`on_cable_received(subscription, &amp;block)\`&quot;">​</a></h3><p>Set the received callback.</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on_cable_received</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(subscription) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |data|</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cable_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  display_message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(message)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h3 id="on-cable-rejected-subscription-block" tabindex="-1"><code>on_cable_rejected(subscription, &amp;block)</code> <a class="header-anchor" href="#on-cable-rejected-subscription-block" aria-label="Permalink to &quot;\`on_cable_rejected(subscription, &amp;block)\`&quot;">​</a></h3><p>Set the rejected callback.</p><h2 id="sending-data" tabindex="-1">Sending Data <a class="header-anchor" href="#sending-data" aria-label="Permalink to &quot;Sending Data&quot;">​</a></h2><h3 id="cable-perform-action-data" tabindex="-1"><code>cable_perform(action, data = {})</code> <a class="header-anchor" href="#cable-perform-action-data" aria-label="Permalink to &quot;\`cable_perform(action, data = {})\`&quot;">​</a></h3><p>Perform an action on the default subscription.</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cable_perform</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:speak</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">message:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Hello!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cable_perform</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:typing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">user_id:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="perform-on-subscription-action-data" tabindex="-1"><code>perform_on(subscription, action, data = {})</code> <a class="header-anchor" href="#perform-on-subscription-action-data" aria-label="Permalink to &quot;\`perform_on(subscription, action, data = {})\`&quot;">​</a></h3><p>Perform an action on a specific subscription.</p><h3 id="cable-send-subscription-data" tabindex="-1"><code>cable_send(subscription, data)</code> <a class="header-anchor" href="#cable-send-subscription-data" aria-label="Permalink to &quot;\`cable_send(subscription, data)\`&quot;">​</a></h3><p>Send raw data on a subscription.</p><h2 id="broadcast-helpers" tabindex="-1">Broadcast Helpers <a class="header-anchor" href="#broadcast-helpers" aria-label="Permalink to &quot;Broadcast Helpers&quot;">​</a></h2><h3 id="handle-html-broadcast-data-target-selector-position-append" tabindex="-1"><code>handle_html_broadcast(data, target_selector, position = :append)</code> <a class="header-anchor" href="#handle-html-broadcast-data-target-selector-position-append" aria-label="Permalink to &quot;\`handle_html_broadcast(data, target_selector, position = :append)\`&quot;">​</a></h3><p>Handle a broadcast containing HTML to insert.</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on_cable_received</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(subscription) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |data|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  handle_html_broadcast</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;#messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><p>Positions: <code>:append</code>, <code>:prepend</code>, <code>:replace</code>, <code>:before</code>, <code>:after</code></p><h3 id="handle-update-broadcast-data-id-key-id-content-key-content" tabindex="-1"><code>handle_update_broadcast(data, id_key = &quot;id&quot;, content_key = &quot;content&quot;)</code> <a class="header-anchor" href="#handle-update-broadcast-data-id-key-id-content-key-content" aria-label="Permalink to &quot;\`handle_update_broadcast(data, id_key = &quot;id&quot;, content_key = &quot;content&quot;)\`&quot;">​</a></h3><p>Handle a broadcast that updates a specific element.</p><h3 id="handle-remove-broadcast-data-id-key-id" tabindex="-1"><code>handle_remove_broadcast(data, id_key = &quot;id&quot;)</code> <a class="header-anchor" href="#handle-remove-broadcast-data-id-key-id" aria-label="Permalink to &quot;\`handle_remove_broadcast(data, id_key = &quot;id&quot;)\`&quot;">​</a></h3><p>Handle a broadcast that removes an element.</p><h2 id="data-extraction" tabindex="-1">Data Extraction <a class="header-anchor" href="#data-extraction" aria-label="Permalink to &quot;Data Extraction&quot;">​</a></h2><h3 id="cable-data-data-key-default-nil" tabindex="-1"><code>cable_data(data, key, default = nil)</code> <a class="header-anchor" href="#cable-data-data-key-default-nil" aria-label="Permalink to &quot;\`cable_data(data, key, default = nil)\`&quot;">​</a></h3><p>Extract a value from received data.</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cable_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cable_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;count&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="cable-data-json-data-key" tabindex="-1"><code>cable_data_json(data, key)</code> <a class="header-anchor" href="#cable-data-json-data-key" aria-label="Permalink to &quot;\`cable_data_json(data, key)\`&quot;">​</a></h3><p>Extract and parse a JSON string from received data.</p><h3 id="cable-data-has-data-key" tabindex="-1"><code>cable_data_has?(data, key)</code> <a class="header-anchor" href="#cable-data-has-data-key" aria-label="Permalink to &quot;\`cable_data_has?(data, key)\`&quot;">​</a></h3><p>Check if received data has a specific key.</p><h3 id="cable-data-type-data-type-key-type" tabindex="-1"><code>cable_data_type(data, type_key = &quot;type&quot;)</code> <a class="header-anchor" href="#cable-data-type-data-type-key-type" aria-label="Permalink to &quot;\`cable_data_type(data, type_key = &quot;type&quot;)\`&quot;">​</a></h3><p>Get data type from received data.</p><h3 id="cable-route-data-handlers-type-key-type" tabindex="-1"><code>cable_route(data, handlers, type_key = &quot;type&quot;)</code> <a class="header-anchor" href="#cable-route-data-handlers-type-key-type" aria-label="Permalink to &quot;\`cable_route(data, handlers, type_key = &quot;type&quot;)\`&quot;">​</a></h3><p>Route incoming data based on type/action.</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on_cable_received</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(subscription) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |data|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  cable_route</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data, {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> =&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handle_message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data) },</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;typing&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> =&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handle_typing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data) },</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;presence&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> =&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handle_presence</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data) }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h2 id="example-real-time-chat" tabindex="-1">Example: Real-time Chat <a class="header-anchor" href="#example-real-time-chat" aria-label="Permalink to &quot;Example: Real-time Chat&quot;">​</a></h2><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ChatController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> StimulusController</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  include</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> OpalVite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Concerns</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">V1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">StimulusHelpers</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  include</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> OpalVite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Concerns</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">V1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ActionCableHelpers</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">targets</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> %w[messages input status]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> connect</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    cable_connect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/cable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    cable_subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ChatChannel&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      params:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">room:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;general&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      on_connected:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update_status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;online&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      on_disconnected:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update_status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;offline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      on_received:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data) { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">display_message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data) }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> disconnect</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cable_disconnect</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> send_message</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">target_value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:input</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> text.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">empty?</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    cable_perform</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:speak</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">text:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> text)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    target_set_value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:input</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> display_message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data)</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cable_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cable_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&lt;p&gt;&lt;strong&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#{user}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:&lt;/strong&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#{text}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;/p&gt;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    handle_html_broadcast</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;html&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> =&gt; html }.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">to_n</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;#messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> update_status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(status)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    target_set_text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, status)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div>`,73)])])}const E=a(t,[["render",l]]);export{o as __pageData,E as default};
